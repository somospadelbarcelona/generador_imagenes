// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model GeneratedImage {
  id            String   @id @default(cuid())
  prompt        String
  negativePrompt String? // What NOT to include
  imageUrl      String
  type          String   // text-to-image, image-to-image, audio-to-image, edit, brand, variation, upscale
  size          String
  sourceImage   String?  // For image-to-image and edit
  sourceAudio   String?  // For audio-to-image
  brandId       String?  // For brand-adapted generation
  styleId       String?  // For saved style reference
  collectionId  String?  // For organizing images
  templateId    String?  // Template used for generation
  parentImageId String?  // For variations (parent image)
  settings      String?  // JSON string for additional settings
  isFavorite    Boolean  @default(false)
  batchId       String?  // For batch generation grouping
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  brand      Brand?      @relation(fields: [brandId], references: [id])
  style      Style?      @relation(fields: [styleId], references: [id])
  collection Collection? @relation(fields: [collectionId], references: [id])
  template   Template?   @relation(fields: [templateId], references: [id])
  parent     GeneratedImage?  @relation("Variations", fields: [parentImageId], references: [id])
  variations GeneratedImage[] @relation("Variations")
}

model Brand {
  id          String   @id @default(cuid())
  name        String
  logoUrl     String?
  colors      String   // JSON string for brand colors
  styleGuide  String?  // Description of brand style
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  images GeneratedImage[]
}

model Style {
  id          String   @id @default(cuid())
  name        String
  description String   // Style description
  promptSuffix String  // What to append to prompts
  exampleUrl  String?  // Example image URL
  category    String?  // artistic, photographic, digital, etc.
  isPublic    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  images GeneratedImage[]
}

model Collection {
  id          String   @id @default(cuid())
  name        String
  description String?
  icon        String?  // Emoji or icon name
  color       String?  // Hex color for UI
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  images GeneratedImage[]
}

model Template {
  id          String   @id @default(cuid())
  name        String
  description String?
  category    String   // social-media, product, logo, banner, etc.
  promptTemplate String // Template with {subject} placeholder
  negativePrompt String?
  settings    String?  // JSON for default size, style, etc.
  previewUrl  String?  // Preview image
  isPublic    Boolean  @default(true)
  usageCount  Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  images GeneratedImage[]
}
