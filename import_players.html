<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Importar Jugadores (Completo)</title>
    <!-- Firebase SDK (v10 Compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <!-- Config -->
    <script src="js/firebase-config.js"></script>
    <script src="js/firebase-init.js"></script>
</head>

<body style="font-family: sans-serif; background: #1a1a1a; color: white; padding: 40px;">
    <div style="max-width: 800px; margin: 0 auto; text-align: center;">
        <h1 style="color: #ccff00;">IMPORTADOR DE JUGADORES (162 Registros)</h1>
        <p>Datos completos cargados. Pulsa el bot√≥n para sincronizar.</p>

        <div id="status"
            style="background: #333; padding: 20px; border-radius: 10px; margin: 20px 0; min-height: 100px; text-align: left; font-family: monospace; max-height: 400px; overflow-y: auto;">
            Listo para importar 162 jugadores.
        </div>

        <button onclick="startImport()"
            style="background: #ccff00; color: black; border: none; padding: 15px 30px; font-size: 1.2rem; font-weight: bold; border-radius: 8px; cursor: pointer;">
            üöÄ INICIAR IMPORTACI√ìN COMPLETA
        </button>
    </div>

    <script>
        async function fetchPlayers() {
            // Fallback strategy: Try fetching the JSON file first (if running on server)
            try {
                const res = await fetch('final_players.json');
                if (res.ok) return await res.json();
            } catch (e) {
                console.log("Fetch failed, using embedded data as backup");
            }
            // Embed data if fetch fails (file:// protocol)
            return [
                { "level": "0", "gender": "chico", "name": "Pablo Mena Gutierrez", "phone": "606220068" },
                { "level": "0", "gender": "chica", "name": "Ver√≥nica Luque Mu√±oz", "phone": "606163956" },
                { "level": "0", "gender": "chica", "name": "Maribel Campoy √Ålvarez", "phone": "655132343" },
                { "level": "0", "gender": "chica", "name": "Silvia L√≥pez Morillo", "phone": "630681727" },
                { "level": "0", "gender": "chica", "name": "M√≥nica Carmona Merch√°n", "phone": "625248776" },
                { "level": "0", "gender": "chica", "name": "Luisa ganis", "phone": "635198182" },
                { "level": "0", "gender": "chica", "name": "Estefan√≠a Vega Freire", "phone": "666080738" },
                { "level": "0", "gender": "chica", "name": "reyes calzada", "phone": "600410483" },
                { "level": "0", "gender": "chica", "name": "Mari luz Cervero Mart√≠nez", "phone": "606557875" },
                { "level": "0", "gender": "chica", "name": "Silvia Serrano Pinilla", "phone": "620597669" },
                { "level": "0", "gender": "chica", "name": "Eva Bov√© Calzada", "phone": "622053220" },
                { "level": "0", "gender": "chica", "name": "Merche Belmonte Rinc√≥n", "phone": "669061970" },
                { "level": "0", "gender": "chica", "name": "Emeline Calafell", "phone": "691868067" },
                { "level": "0", "gender": "chica", "name": "Mar√≠a Mu√±oz Casta√±o", "phone": "653241102" },
                { "level": "0", "gender": "chica", "name": "Marta Farr√© Foj", "phone": "607034287" },
                { "level": "0", "gender": "chico", "name": "Carlos L√≥pez Mestre", "phone": "722535577" },
                { "level": "0", "gender": "chico", "name": "Alvaro Fernandez Serrano", "phone": "640677832" },
                { "level": "0", "gender": "chico", "name": "Arnau Santamaria Pi√±ol", "phone": "699572103" },
                { "level": "0", "gender": "chico", "name": "Adrian Mu√±oz Perez", "phone": "683615092" },
                { "level": "0", "gender": "chico", "name": "Pablo Kellermann", "phone": "658904074" },
                { "level": "0", "gender": "chico", "name": "Joel Sanchez Portillo", "phone": "687806479" },
                { "level": "0", "gender": "chico", "name": "Carlos David Asmadt Calderon", "phone": "669475989" },
                { "level": "0", "gender": "chico", "name": "Sergio Mart√≠n Canales", "phone": "676410577" },
                { "level": "0", "gender": "chico", "name": "Alex Espinosa Touzon", "phone": "600057944" },
                { "level": "0", "gender": "chico", "name": "Ra√∫l Garc√≠a √Ålvarez", "phone": "620188338" },
                { "level": "0", "gender": "chico", "name": "Toni Palau Zaragoza", "phone": "603602342" },
                { "level": "0", "gender": "chico", "name": "Victor illana Rodr√≠guez", "phone": "676024269" },
                { "level": "0", "gender": "chico", "name": "Jan Pastor Caballero", "phone": "646169823" },
                { "level": "0", "gender": "chico", "name": "DAVID D√çAZ COTES", "phone": "667725861" },
                { "level": "0", "gender": "chico", "name": "Vicen√ß L√≥pez", "phone": "60716380" },
                { "level": "0", "gender": "chico", "name": "Eloy Arrabal Baz√°n", "phone": "622427803" },
                { "level": "0", "gender": "chico", "name": "Juanjo Ruiz (Jota)", "phone": "617938301" },
                { "level": "0", "gender": "chico", "name": "Marcos Clemente Molinero", "phone": "644412306" },
                { "level": "0", "gender": "chico", "name": "Abraham Rosell Claveras", "phone": "656989230" },
                { "level": "0", "gender": "chico", "name": "Miquel mu√±oz gaudes", "phone": "609340623" },
                { "level": "0", "gender": "chico", "name": "Emilio Jos√© Pe√±alver", "phone": "664605659" },
                { "level": "0", "gender": "chico", "name": "Carles Garcia Castellanos", "phone": "660103947" },
                { "level": "0", "gender": "chico", "name": "Gerardo Jaenes Perez", "phone": "639640163" },
                { "level": "0", "gender": "chico", "name": "Marc pijuan arnau", "phone": "610830776" },
                { "level": "0", "gender": "chico", "name": "Carlos Canosa Romano", "phone": "63823286" },
                { "level": "0", "gender": "chico", "name": "David Coca Pin√©", "phone": "625882517" },
                { "level": "0", "gender": "chico", "name": "David Pastor", "phone": "637521778" },
                { "level": "0", "gender": "chico", "name": "Rom√°n Guzman", "phone": "670263922" },
                { "level": "0", "gender": "chico", "name": "Xavier Mondragon Artiga", "phone": "647635991" },
                { "level": "0", "gender": "chico", "name": "Aitor Davalillo Manteca", "phone": "620015515" },
                { "level": "0", "gender": "chico", "name": "Mario Aguilera Ord√≥√±ez", "phone": "661108647" },
                { "level": "0", "gender": "chico", "name": "David Meseguer Garcia", "phone": "636 68 71 67" },
                { "level": "0", "gender": "chico", "name": "Luis Pino Vazquez", "phone": "664020122" },
                { "level": "0", "gender": "chico", "name": "Pol Berenguer Pag√°n", "phone": "619524874" },
                { "level": "0", "gender": "chico", "name": "Ronny Benalc√°zar", "phone": "660340715" },
                { "level": "0", "gender": "chico", "name": "Rub√©n Rosende Molina", "phone": "699601764" },
                { "level": "0", "gender": "chico", "name": "Eric Alcantara Pascual", "phone": "628112462" },
                { "level": "0", "gender": "chico", "name": "Alex Mart√≠nez Roda", "phone": "667974931" },
                { "level": "0", "gender": "chico", "name": "Miguel √Ångel M√©ndez Ruiz", "phone": "644444319" },
                { "level": "0", "gender": "chico", "name": "Alex  Cuadra Cabezas", "phone": "696422128" },
                { "level": "0", "gender": "chico", "name": "Ernesto Rodera", "phone": "648096123" },
                { "level": "0", "gender": "chico", "name": "Toni Mill√°n Deu", "phone": "619730816" },
                { "level": "0", "gender": "chico", "name": "Juan Manuel Le√≥n", "phone": "630569255" },
                { "level": "0", "gender": "chico", "name": "Octavi Navarro Carbonell", "phone": "650521668" },
                { "level": "0", "gender": "chico", "name": "Josre Maria Guti√©rrez L√≥pez", "phone": "622727475" },
                { "level": "0", "gender": "chico", "name": "Enrique Fontoba Espimal", "phone": "620679004" },
                { "level": "0", "gender": "chico", "name": "Nil Espinosa Ca√±as", "phone": "608185320" },
                { "level": "0", "gender": "chico", "name": "David Navea Vida", "phone": "605036686" },
                { "level": "0", "gender": "chico", "name": "ALBERTO MU√ëOZ ALGORA", "phone": "629441650" },
                { "level": "0", "gender": "chica", "name": "Clara Fern√°ndez", "phone": "636514362" },
                { "level": "0", "gender": "chica", "name": "Cristina Garc√≠a -Mila", "phone": "630132285" },
                { "level": "0", "gender": "chico", "name": "Josep Maria Rochera Revilla", "phone": "657467573" },
                { "level": "0", "gender": "chico", "name": "Juan Jos√© Jim√©nez", "phone": "608209007" },
                { "level": "0", "gender": "chica", "name": "Lola Caro Burguillos", "phone": "645895958" },
                { "level": "0", "gender": "chica", "name": "Maika Gonz√°lez G√≥mez", "phone": "636252043" },
                { "level": "0", "gender": "chico", "name": "Manuel Gamero Plaza", "phone": "636776592" },
                { "level": "0", "gender": "chica", "name": "Mariona Leyes", "phone": "646525263" },
                { "level": "0", "gender": "chica", "name": "NATALIE SOROLLA FOSTER", "phone": "666050302" },
                { "level": "0", "gender": "chica", "name": "Olga Pylypchuk", "phone": "628 518 095" },
                { "level": "0", "gender": "chico", "name": "√íscar Fort Salda√±a", "phone": "627974750" },
                { "level": "0", "gender": "chico", "name": "Pedro roca roca", "phone": "658 953 150" },
                { "level": "0", "gender": "chico", "name": "Ram√≥n Mej√≠as Ramos", "phone": "648828737" },
                { "level": "0", "gender": "chica", "name": "Rosa Dom√≠nguez Merino", "phone": "605585184" },
                { "level": "0", "gender": "chica", "name": "Rosa Dom√≠nguez Merino", "phone": "605585184" },
                { "level": "0", "gender": "chico", "name": "Sergio Serrano Vila", "phone": "669329212" },
                { "level": "0", "gender": "chica", "name": "Ver√≥nica Silva Cerd√†", "phone": "663071282" },
                { "level": "0", "gender": "chico", "name": "Vladimir Starciuc", "phone": "650870484" },
                { "level": "0", "gender": "chica", "name": "Berta Ca√±as Porte", "phone": "663946388" },
                { "level": "0", "gender": "chica", "name": "Andrea Vivancos Cano", "phone": "617078923" },
                { "level": "0", "gender": "chica", "name": "Ariadna Majua Monta√±es", "phone": "660149966" },
                { "level": "0", "gender": "chica", "name": "Sonia L√≥pez Fern√°ndez", "phone": "696179599" },
                { "level": "0", "gender": "chica", "name": "Cristina Matamala Tudela", "phone": "687868069" },
                { "level": "0", "gender": "chica", "name": "Gemma Saavedra Guarch", "phone": "636407210" },
                { "level": "0", "gender": "chica", "name": "N√°dia Flora Costa", "phone": "657652817" },
                { "level": "0", "gender": "chica", "name": "Mayte Vega Santos", "phone": "680502210" },
                { "level": "0", "gender": "chica", "name": "Esther Carrillo conde", "phone": "656333800" },
                { "level": "0", "gender": "chica", "name": "Monica Perez Pa√±ella", "phone": "696101278" },
                { "level": "0", "gender": "chica", "name": "Agata Del Real Pe√±a", "phone": "609405289" },
                { "level": "0", "gender": "chica", "name": "SANDRA RIERA CARMONA", "phone": "657581454" },
                { "level": "0", "gender": "chica", "name": "Yolanda Sanz Gonzalez", "phone": "699217479" },
                { "level": "0", "gender": "chica", "name": "Marta Bassons Tur√∫", "phone": "635404490" },
                { "level": "0", "gender": "chica", "name": "Joana  Garcia Cuadros", "phone": "696897283" },
                { "level": "0", "gender": "chica", "name": "ELENA P√ÅEZ FERN√ÅNDEZ", "phone": "650362634" },
                { "level": "0", "gender": "chica", "name": "Saray Mu√±oz Carod", "phone": "627430755" },
                { "level": "0", "gender": "chica", "name": "RAQUEL Fernandez Fernandez", "phone": "613010874" },
                { "level": "0", "gender": "chico", "name": "Alberto Javier Martin Mata", "phone": "607224061" },
                { "level": "0", "gender": "chico", "name": "Alejandro Coscolin Peregrin", "phone": "649219350" },
                { "level": "0", "gender": "chico", "name": "Bernat Pecharrom√°n Vilamitjana", "phone": "617979850" },
                { "level": "0", "gender": "chico", "name": "Daniel Astasio Quir√≥s", "phone": "646603954" },
                { "level": "0", "gender": "chico", "name": "David Asensio Guerrero", "phone": "645934803" },
                { "level": "0", "gender": "chico", "name": "Fernando Garcia-Mauri√±o de Delas", "phone": "630882973" },
                { "level": "0", "gender": "chico", "name": "Fernando Rodr√≠guez Sequ√≠", "phone": "610712798" },
                { "level": "0", "gender": "chico", "name": "Frederic cano", "phone": "661160549" },
                { "level": "0", "gender": "chico", "name": "Javier Alejandro Hita P√©rez", "phone": "663369382" },
                { "level": "0", "gender": "chico", "name": "Jos√© Mar√≠a Pellejero Recio", "phone": "650941040" },
                { "level": "0", "gender": "chico", "name": "Juan Manuel L√≥pez Asenjo", "phone": "660307261" },
                { "level": "0", "gender": "chico", "name": "Luis Angel S√°nchez Rodr√≠guez", "phone": "676 56 89 56" },
                { "level": "0", "gender": "chico", "name": "Miguel Mu√±oz Melero", "phone": "626823635" },
                { "level": "0", "gender": "chico", "name": "OSCAR COSCOLIN GENOVA", "phone": "623206328" },
                { "level": "0", "gender": "chico", "name": "Pau Martin Galvez", "phone": "618353118" },
                { "level": "0", "gender": "chico", "name": "Sergi D√≠ez", "phone": "658128436" },
                { "level": "0", "gender": "chico", "name": "Sergio albert ortega", "phone": "670250716" },
                { "level": "0", "gender": "chico", "name": "Toni Garc√≠a Morales", "phone": "610511698" },
                { "level": "0", "gender": "chico", "name": "Victor Espinosa Sanchez", "phone": "697723371" },
                { "level": "0", "gender": "chico", "name": "Vladimir Starciuc", "phone": "650870484" },
                { "level": "0", "gender": "chico", "name": "Albert Garcia Edo", "phone": "607563723" },
                { "level": "0", "gender": "chica", "name": "Ana√Øs Grebot", "phone": "33628957511" },
                { "level": "0", "gender": "chico", "name": "Dani Ramoneda", "phone": "608048666" },
                { "level": "0", "gender": "chico", "name": "Kevin Mancilla Serrano", "phone": "657525190" },
                { "level": "0", "gender": "chica", "name": "Laura Baltic Flores", "phone": "678913087" },
                { "level": "0", "gender": "chica", "name": "Lluisa Ramoneda Garcia", "phone": "686101804" },
                { "level": "0", "gender": "chica", "name": "M¬™ Jose Mart√≠nez Valdecantos", "phone": "659718012" },
                { "level": "0", "gender": "chica", "name": "Marta Murugarren Chumillas", "phone": "633303771" },
                { "level": "0", "gender": "chica", "name": "NATALIA FARR√â ROIG", "phone": "616068976" },
                { "level": "0", "gender": "chica", "name": "Noelia Ornaque Mu√±oz", "phone": "626109887" },
                { "level": "0", "gender": "chica", "name": "Pili Jorques", "phone": "609 27 89 27" },
                { "level": "0", "gender": "chica", "name": "RAQUEL FDEZ FEDZ", "phone": "613010874" },
                { "level": "0", "gender": "chica", "name": "Sonia rodriguez pulido", "phone": "677275398" },
                { "level": "0", "gender": "chica", "name": "Sonja Nijhof", "phone": "605779897" },
                { "level": "0", "gender": "chica", "name": "Victoria Mota", "phone": "687127713" },
                { "level": "0", "gender": "chico", "name": "Alberto barba baena", "phone": "696359442" },
                { "level": "0", "gender": "chico", "name": "√Ångel Cruz Romero", "phone": "679004717" },
                { "level": "0", "gender": "chica", "name": "Anna Gaseni Sapena", "phone": "639345645" },
                { "level": "0", "gender": "chico", "name": "Antonio Navajas Lindez", "phone": "655280281" },
                { "level": "0", "gender": "chica", "name": "Bianca barboza", "phone": "670454813" },
                { "level": "0", "gender": "chica", "name": "Carlota Calabuig", "phone": "667767494" },
                { "level": "0", "gender": "chico", "name": "Edu Costa", "phone": "666716626" },
                { "level": "0", "gender": "chico", "name": "FRANCISCO JAVIER JOBANI VIDAL", "phone": "667223534" },
                { "level": "0", "gender": "chico", "name": "Gregor Stajer", "phone": "651842497" },
                { "level": "0", "gender": "chico", "name": "Javier Frauca Ferre", "phone": "658136860" },
                { "level": "0", "gender": "chico", "name": "Jordi D√≠az Blanch", "phone": "654172013" },
                { "level": "0", "gender": "chico", "name": "Jordi Seuba Garces", "phone": "678560840" },
                { "level": "0", "gender": "chico", "name": "Jorge Rueda Ruiz", "phone": "609815330" },
                { "level": "0", "gender": "chico", "name": "Jose Luis Bergas S√°nchez", "phone": "655684949" },
                { "level": "0", "gender": "chico", "name": "Julio Alberto Saez Amarillo", "phone": "644304498" },
                { "level": "0", "gender": "chica", "name": "Mariam Quimis", "phone": "632732362" },
                { "level": "0", "gender": "chica", "name": "Montse L√≥pez Sans", "phone": "609628981" },
                { "level": "0", "gender": "chica", "name": "Natalia  Guasch S√°nchez", "phone": "676027823" },
                { "level": "0", "gender": "chica", "name": "Paula alves de araujo", "phone": "671541433" },
                { "level": "0", "gender": "chico", "name": "Plamen Penchev Tanev", "phone": "618462482" },
                { "level": "0", "gender": "chico", "name": "ROBERTO JAIME SANCHIS", "phone": "629621183" },
                { "level": "0", "gender": "chica", "name": "Sara Vallmajo Gomez", "phone": "657949743" },
                { "level": "0", "gender": "chica", "name": "Silvia Martin Rodriguez", "phone": "627362511" },
                { "level": "0", "gender": "chica", "name": "Sonia medina parra", "phone": "622170435" },
                { "level": "0", "gender": "chica", "name": "TERESA GOMEZ GRISO", "phone": "639147090" },
                { "level": "0", "gender": "chica", "name": "Txus Lopez", "phone": "637187616" },
                { "level": "0", "gender": "chica", "name": "Yolanda presa", "phone": "654615665" }
            ];
        }

        async function startImport() {
            const status = document.getElementById('status');
            status.innerHTML = "Cargando datos...";

            const players = await fetchPlayers();

            if (!players || players.length === 0) {
                status.innerHTML += `<br><span style="color:red">No se encontraron datos para importar.</span>`;
                return;
            }

            if (!confirm(`Se van a ELIMINAR los jugadores actuales e importar ${players.length} nuevos. ¬øContinuar?`)) {
                status.innerHTML += `<br>Importaci√≥n cancelada.`;
                return;
            }

            status.innerHTML = `üßπ Limpiando base de datos actual...<br>`;
            try {
                const snapshot = await window.db.collection('players').get();
                const totalToDelete = snapshot.size;
                let deletedCount = 0;

                for (const doc of snapshot.docs) {
                    // Proteger al admin principal si se desea, o borrar todo. 
                    // El usuario pide "machacar", as√≠ que borraremos todo.
                    await doc.ref.delete();
                    deletedCount++;
                    if (deletedCount % 10 === 0) status.innerHTML = `üßπ Limpiando: ${deletedCount}/${totalToDelete}<br>`;
                }
                status.innerHTML += `‚úÖ Base de datos limpia.<br>`;
            } catch (err) {
                status.innerHTML += `<span style="color:orange">‚ö†Ô∏è Error limpiando (o ya estaba vac√≠a): ${err.message}</span><br>`;
            }

            status.innerHTML += `üöÄ Iniciando carga masiva de ${players.length} jugadores...<br>`;

            let count = 0;
            const batchSize = 10;

            for (let i = 0; i < players.length; i++) {
                const p = players[i];
                const rawName = p.name || "Sin Nombre";
                const rawPhone = (p.phone || "").toString().replace(/\D/g, '');

                if (!rawPhone || rawPhone.length < 9) {
                    status.innerHTML += `<span style="color:#ff6b6b">Saltado (Tel√©fono inv√°lido): ${rawName} - ${rawPhone}</span><br>`;
                    continue;
                }

                const uid = "u_" + rawPhone;

                const userData = {
                    id: uid,
                    name: rawName.toLowerCase().split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' '),
                    phone: rawPhone,
                    password: "PADEL26",
                    level: "3.5",
                    self_rate_level: "3.5",
                    gender: (() => {
                        // Check multiple common keys in case of JSON variants
                        const genderSource = p.gender || p.G√©nero || p.genero || "";
                        const g = genderSource.toString().toUpperCase();
                        return (g === "F" || g === "CHICA" || g === "FEMENINO") ? "chica" : "chico";
                    })(),
                    role: "player",
                    status: "active",
                    membership: "somospadel_bcn",
                    matches_played: 0,
                    win_rate: 0,
                    createdAt: new Date().toISOString()
                };

                try {
                    await window.db.collection('players').doc(uid).set(userData); // No merge, full overwrite
                    status.innerHTML += `<span style="color:#69f0ae">‚úÖ [${i + 1}/${players.length}] Importado: ${userData.name}</span><br>`;
                    count++;
                } catch (err) {
                    status.innerHTML += `<span style="color:#ff6b6b">‚ùå Error con ${userData.name}: ${err.message}</span><br>`;
                }

                status.scrollTop = status.scrollHeight; // Auto scroll
                if (i % batchSize === 0) await new Promise(r => setTimeout(r, 50));
            }

            status.innerHTML += `<br><h1 style="color:#ccff00">¬°PROCESO TERMINADO!</h1>`;
            status.innerHTML += `Total importados: ${count}`;
        }
    </script>
</body>

</html>